<!-- 
    RSS template for the home page
    Copyright (c) 2025 Rye (itsrye.dev)
    Licensed under Apache License 2.0
-->

<!-- the default template for hugo rss feeds-->

{{- $authorEmail := "" }}
{{- with site.Params.author }}
  {{- if reflect.IsMap . }}
    {{- with .email }}
      {{- $authorEmail = . }}
    {{- end }}
  {{- end }}
{{- end }}

{{- $authorName := "" }}
{{- with site.Params.author }}
  {{- if reflect.IsMap . }}
    {{- with .name }}
      {{- $authorName = . }}
    {{- end }}
  {{- else }}
    {{- $authorName  = . }}
  {{- end }}
{{- end }}

{{- $pctx := . }}
{{- if .IsHome }}{{ $pctx = .Site }}{{ end }}
{{- $pages := slice }}
{{- if or $.IsHome $.IsSection }}
{{- $pages = $pctx.RegularPages }}
{{- else }}
{{- $pages = $pctx.Pages }}
{{- end }}
{{- $limit := .Site.Config.Services.RSS.Limit }}
{{- if ge $limit 1 }}
{{- $pages = $pages | first $limit }}
{{- end }}
<rss 
    version="2.0" 
    xmlns:atom="http://www.w3.org/2005/Atom"
    >
  <channel>
    <title> {{ if eq .Title .Site.Title }}{{ .Site.Title }}{{ else }}{{ with .Title }}{{ . }} on {{ end }}{{ .Site.Title }}{{ end }} </title>
    <link> {{ .Permalink }} </link>
    <description> Recent content {{ if ne .Title .Site.Title }}{{ with .Title }}in {{ . }} {{ end }}{{ end }}on {{ .Site.Title }} </description>
    <generator> Hugo </generator>
    <atom:generator 
        uri="https://gohugo.io/" 
        version="{{ hugo.Version }}">
        Hugo
    </atom:generator>
    {{ $iconpath := .Site.Params.icon | default "images/favicon/default.ico" }}{{ with resources.Get $iconpath }} {{ with . | fingerprint }}{{ with resources.Copy "/rye/rss/images/favicon.ico" . | fingerprint }}<atom:icon integrity="{{ .Data.Integrity }}">{{ .Permalink }}</atom:icon>{{ end }}{{ end }}{{ end }}
    <language> {{ site.Language.LanguageCode }} </language>
    {{ with $authorEmail }} <managingEditor>{{.}}{{ with $authorName }} ({{ . }}){{ end }}</managingEditor>{{ end }}
    {{ with $authorEmail }} <webMaster>{{ . }}{{ with $authorName }} ({{ . }}){{ end }}</webMaster> {{ end }}
    {{ with .Site.Copyright }}<copyright>{{ . }}</copyright>{{ end }}
    {{ if not .Site.Copyright }} {{ with .Site.Params.legal.copyrightHolder }} <copyright>Copyright {{ now.Format "2006" }} by {{ . }}</copyright>{{ end }}{{ end }}
    {{ if not .Date.IsZero }}<lastBuildDate>{{ (index $pages.ByLastmod.Reverse 0).Lastmod.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</lastBuildDate>{{ end }}
    {{- with .OutputFormats.Get "RSS" }}<atom:link href="{{ .Permalink }}" rel="self" type="{{ .MediaType }}" />{{- end }}
    {{- range $pages }}
    <item>
        <title>{{ .Title }}</title>
        <link>{{ .Permalink }}</link>
        {{ with .Params.uuid }}
            <atom:id>{{ . }}</atom:id>
        {{ end }}
        <pubDate> {{ .PublishDate.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }} </pubDate>
        {{- with $authorEmail }}
            <author> {{ . }}{{ with $authorName }} ({{ . }}){{ end }} </author>
        {{ end }}
        <atom:author>
            <atom:name>{{ $authorName }}</atom:name>
            {{- with $authorEmail }}<atom:email>{{ $authorEmail }}</atom:email>{{- end }}
            <atom:uri>{{ $.Site.BaseURL }}/schema/person</atom:uri>
        </atom:author>
        <guid> {{ .Permalink }} </guid>
        <description> {{ .Summary | transform.XMLEscape | safeHTML }} </description>
    </item>
    {{- end }}
  </channel>
</rss>